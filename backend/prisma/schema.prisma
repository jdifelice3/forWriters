/* CONNECTIVITY */


generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}


/* Enums */

enum DocumentType {
  MANUSCRIPT
  FEEDBACK
}

enum EventUserType {
  AUTHOR
  REVIEWER
}

enum EventType {
  READING
  RETREAT
}

enum Genre {
  FANTASY
  HISTORICAL
  HORROR
  LITERARY
  MYSTERY
  POEM
  ROMANCE
  SCIENCEFICTION
}

enum GroupType {
  WRITING
}

enum FileType {
  DOCX
  PDF
}

enum Role {
  ADMIN
  EDITOR
  READER
}

enum UrlOwnerType {
  USER
  WRITINGGROUP
}

enum UrlType {
  AUDIO
  FACEBOOK
  IMAGE
  LINKEDIN
  MEETUP
  SUBSTACK
  WEBSITE
  YOUTUBE
}

enum WorkType {
  FLASHFICTION
  NOVEL
  NOVELLA
  NOVELETTE
  PLAY
  SCREENPLAY
  SERIALIZEDFICTION
  SHORTSTORY
}


/* MODELS */


model AppFiles {
  id          String    @id @default(cuid())
  userId      String    
  title       String
  description String?
  filename    String
  documentType DocumentType  @default(MANUSCRIPT)
  mimetype    FileType  @default(PDF)   
  url         String
  uploadedAt  DateTime  @default(now())

  eventSignups   EventSignups[]
  users        Users     @relation(fields: [userId], references: [id])
}

model Events {
  id              String                  @id @default(cuid())
  name            String
  eventType       EventType               @default(READING)
  EventUserType   EventUserType           @default(AUTHOR)
  createdAt       DateTime                @default(now())
  createdUserId   String
  eventDate       String
  eventTime       String
  eventLocation   String
  description     String

  createdUser     Users                   @relation(fields: [createdUserId], references: [id])
  eventsUsers     EventsUsers[]
}

model EventSignups {
  id          String   @id @default(cuid())
  eventId     String
  userId      String
  appFileId   String?
  signedAt    DateTime @default(now())

  groupEvents       GroupsEvents        @relation(fields: [eventId], references: [id])
  users        Users              @relation(fields: [userId], references: [id])
  appFiles  AppFiles?          @relation(fields: [appFileId], references: [id])
  @@unique([eventId, userId, appFileId])
}

model EventsUsers {
  id              String                  @id @default(cuid())
  eventId         String  
  userId          String
  isAdmin         Boolean                 @default(false)
  joinedAt        DateTime                @default(now())

  events          Events                  @relation(fields:[eventId], references:[id])
  users           Users                   @relation(fields:[userId], references:[id])
  @@unique([eventId, userId])
}

model Groups {
  id              String        @id @default(cuid())
  creatorUserId   String  
  groupType       GroupType     @default(WRITING)
  name            String        @unique
  description     String?
  imageUrl        String?
  websiteUrl      String?
  createdAt       DateTime      @default(now())
  updatedAt       DateTime      @updatedAt

  groupsAddresses         GroupsAddresses[]
  groupsUsers     GroupsUsers[]
  newsItems       GroupsNews[]
  events          GroupsEvents[]
  groupsUrls            GroupsUrls[]          
  users           Users      @relation(fields: [creatorUserId], references: [id])
}

model GroupsAddresses {
  id          String   @id @default(cuid())
  street      String  
  city        String
  state       String
  zip         String

  groupId     String   
  groups      Groups?   @relation(fields: [groupId], references: [id])
}

model GroupsEvents {
  id                  String   @id @default(cuid())
  groupId             String
  eventType           EventType       @default(READING)
  eventUserType       EventUserType           @default(AUTHOR)
  eventDate           DateTime
  submissionDeadline  DateTime
  minDaysBetweenReads Int      @default(20) // configurable
  maxConsecutiveReads Int      @default(1)  // e.g., can't sign up twice in a row
  createdAt           DateTime @default(now())

  groups               Groups @relation(fields: [groupId], references: [id])
  signups             EventSignups[]
}

model GroupsNews {
  id          String   @id @default(cuid())
  groupId     String
  title       String
  content     String?
  postedAt    DateTime @default(now())
  archived    Boolean  @default(false)  

  groups       Groups @relation(fields: [groupId], references: [id])
}

model GroupsUsers {
  id            String   @id @default(cuid())
  userId        String
  groupId       String
  isAdmin       Boolean  @default(false)
  invitedBy     String?
  createdAt     DateTime @default(now())

  users          Users    @relation(fields: [userId], references: [id])
  groups         Groups   @relation(fields: [groupId], references: [id])
  @@unique([groupId, userId])
}

model GroupsUrls {
  id               String                 @id @default(cuid())
  url              String
  groupId          String                 
  urlType          UrlType                @default(WEBSITE)
  createdAt DateTime                      @default(now())

  groups      Groups?   @relation(fields: [groupId], references: [id])
}

model Users {
  id             String                   @id @default(cuid())
  superTokensId  String                   @unique
  email          String                   @unique
  role           Role                     @default(EDITOR)
  username       String                   @unique
  createdAt      DateTime                 @default(now())
  updatedAt      DateTime                 @updatedAt

  groupsUsers  GroupsUsers[]
  groups        Groups[]
  eventSignups   EventSignups[]
  works          Works[]
  events         Events[]
  eventsUsers    EventsUsers[]
  userProfiles   UserProfiles?
  appFiles        AppFiles[]
  urls            UsersUrls[]  
}

model UserProfiles {
  id              String                  @id @default(cuid())
  userId          String                  @unique
  firstName       String?
  lastName        String?
  phone           String?
  bio             String?
  
  users            Users                   @relation(fields:[userId], references:[id])
}

model UsersUrls {
  id               String                 @id @default(cuid())
  url              String
  userId           String                 
  urlType          UrlType                @default(WEBSITE)
  createdAt DateTime                      @default(now())

  users            Users?                 @relation(fields: [userId], references: [id])
}

model Works {
  id                   String             @id @default(cuid())
  createdAt            DateTime           @default(now())
  userId               String        
  workType             WorkType
  title                String
  description          String?
  wordCount            Int?
  pageCount            Int?
  genre                Genre
  fileName             String?
  manuscriptIsVisible  Boolean          @default(false)

  users                 Users            @relation(fields: [userId], references: [id])
}